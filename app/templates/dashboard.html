<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>工作台</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
<header class="topbar">
    <h1>工作台</h1>
    <div class="toggles">
        {% if user.is_admin %}
        <a href="/admin/dashboard" class="btn">后台管理</a>
        {% endif %}
        <span>{{ user.email }}</span>
        <a href="/" class="btn ghost" onclick="document.cookie='access_token=; Max-Age=0; path=/'; localStorage.removeItem('token');">退出</a>
    </div>
</header>

<section class="panel">
    <h2>添加单词</h2>
    <form id="add-word-form">
        <div class="grid">
            <label>英文
                <input name="english" placeholder="hello">
            </label>
            <label>中文
                <input name="chinese" placeholder="你好">
            </label>
            <label>词性
                <input name="part_of_speech" placeholder="noun">
            </label>
        </div>
        <label>定义
            <textarea name="definition" placeholder="greeting used when meeting"></textarea>
        </label>
        <label>例句
            <textarea name="examples" placeholder="Hello, world!"></textarea>
        </label>
        <div class="actions">
            <button class="btn" type="button" id="ai-complete">AI 补全</button>
            <button class="btn ghost" type="submit">保存</button>
        </div>
        <pre id="completion-output" style="display: none;"></pre>
    </form>
</section>

<section class="panel">
    <h2>我的单词</h2>
    <table>
        <thead>
        <tr>
            <th>英文</th>
            <th>中文</th>
            <th>词性</th>
            <th>定义</th>
            <th>操作</th>
        </tr>
        </thead>
        <tbody>
        {% for word in words %}
            <tr>
                <td>{{ word.english }}</td>
                <td>{{ word.chinese }}</td>
                <td>{{ word.part_of_speech }}</td>
                <td>{{ word.definition }}</td>
                <td>
                    <button class="btn danger" onclick="deleteWord({{ word.id }})">删除</button>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</section>

<section class="panel">
    <h2>背单词</h2>
    <form id="start-review">
        <label>模式
            <select name="mode">
                <option value="en_to_zh">英 → 中</option>
                <option value="zh_to_en">中 → 英</option>
            </select>
        </label>
        <label>数量
            <input name="count" type="number" value="5" min="1" max="30">
        </label>
        <button class="btn" type="submit">开始</button>
    </form>
    <div id="review-area"></div>
</section>

<script src="/static/app.js"></script>
<script>
async function deleteWord(id) {
    if(!confirm("确定删除吗？")) return;
    const token = localStorage.getItem("token");
    await fetch(`/words/${id}`, {
        method: "DELETE",
        headers: { Authorization: `Bearer ${token}` }
    });
    location.reload();
}
</script>
</body>
</html>